CREATE TABLE IF NOT EXISTS peeppea_blog (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    summary VARCHAR(255),
    content TEXT,
    likes INT DEFAULT 0,
    no_of_comments INT DEFAULT 0,
    user_id INT NOT NULL,
    image_path VARCHAR(255),
    date_created TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);

-- Create a function to automatically generate a summary
CREATE OR REPLACE FUNCTION set_summary()
RETURNS TRIGGER AS $$
BEGIN
    NEW.summary := LEFT(NEW.content, 33) || '...';
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

-- Create a trigger to set the summary before inserting or updating
CREATE TRIGGER trigger_set_summary
BEFORE INSERT OR UPDATE ON peeppea_blog
FOR EACH ROW EXECUTE FUNCTION set_summary();

-- Now insert data without setting the summary explicitly
INSERT INTO peeppea_blog (title, content, user_id, image_path, likes, no_of_comments)
VALUES ('Peep Pea! - dev post', 'Hi, my name is Drew Erskine. I''m a solo developer driven by creating innovative web applications using technologies like Spring Boot 3, Java 21, React, PostgreSQL, Docker, and cloud services such as AWS. This is my personal blog where I''ll share insights, updates, and musings about my journey in web development. Welcome to PeepPea.com!', 1, 'images/user/1/PeepPea-Projects.png', 0, 0),
       ('PeepPea the Goat', 'All hail PeepPea, don''t get it wrong she''s a GOAT. Those who oppose her might will be banished to the realm of burning, a place far beyond the trenches of demise, enduring a fate a thousand times worse than the mythical shadow realm. Let the stories of her reign be a warning to the unwary.', 1, 'images/user/1/peeppea-realm.jpg', 0, 0),
       ('Nala', 'Today, Cooper tried to bite me, thinking he could catch me off guardâ€”little does he know, I am Nala, swift as a snake. Watch me dash one way, then whirl around 180 degrees seven times, only to speed off in the same direction I came from. You can''t catch me. Nala!', 1, 'images/user/1/nala-genius.jpg', 0, 0);
